#!/usr/bin/env python
from __future__ import print_function
import configparser
import logging
import re
import os
import sys
import time

from imc import database
from imc import imc
from imc import imclient
from imc import opaclient
from imc import tokens
from imc import utilities

# Configuration
CONFIG = utilities.get_config()

if __name__ == "__main__":
    infra_id = sys.argv[1]
    logging.basicConfig(filename=CONFIG.get('logs', 'filename').replace('.log', '-destroyer-%s.log' % infra_id),
                        level=logging.INFO,
                        format='%(asctime)s %(message)s')

    logging.info('Starting deletion of infrastructure')

    db = database.get_db()
    if db.connect():
        imc.delete(infra_id)
        db.close()

    logging.info('Completed deleting infrastructure')

